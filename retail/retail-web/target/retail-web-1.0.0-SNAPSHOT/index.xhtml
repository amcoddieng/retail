<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>Catalogue Produits</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <h:outputStylesheet library="primefaces" name="primeicons/primeicons.css"/>
        <style>
        /* Variables CSS */
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --dark: #1d3557;
            --light: #f8f9fa;
            --border: #e9ecef;
            --text: #2b2d42;
            --text-light: #6c757d;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
        }
        
        .cart-wrapper{ position:relative; display:inline-block; }
		.cart-btn{ width:48px; height:48px; border-radius:50%; padding:0; }

		
		.cart-count{
		  position:absolute; top:-6px; right:-6px;
		  background: var(--warning); color:#fff;
		  border-radius:50%; width:22px; height:22px;
		  display:flex; align-items:center; justify-content:center;
		  font-size:.8rem; font-weight:700; box-shadow: var(--shadow);
		}
		        

        .catalogue-app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Messages */
        .custom-messages {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
        }

        /* En-tête */
        .catalogue-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .brand-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .brand-info .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .brand-info .page-subtitle {
            color: var(--text-light);
            margin: 0;
            font-size: 0.9rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .guest-actions, .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .auth-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .login-btn {
            background: var(--primary);
            color: white;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .register-btn {
            background: transparent;
            border-color: var(--primary);
            color: var(--primary);
        }

        .register-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .user-welcome {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text);
            font-weight: 500;
        }

        .cart-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .cart-btn {
            position: relative;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .cart-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--warning);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .orders-btn {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            transition: var(--transition);
        }

        .orders-btn:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
        }

        .header-banner {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.75rem 2rem;
        }

        .banner-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            font-size: 0.9rem;
        }

        .banner-content i {
            font-size: 1.1rem;
        }

        /* Contenu principal */
        .catalogue-main {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Section produits */
        .products-section {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            margin: 0;
        }

        .products-count {
            color: var(--text-light);
            font-weight: 500;
        }

        /* Grille des produits */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Carte produit */
        .product-card {
            background: var(--light);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--border);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .product-badges {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 2;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .badge-warning {
            background: var(--warning);
        }

        .badge-danger {
            background: var(--danger);
        }

        .badge-new {
            background: var(--success);
        }

        .product-image {
            position: relative;
            height: 200px;
            background: white;
            overflow: hidden;
        }

        .image-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
        }

        .product-card:hover .image-overlay {
            opacity: 1;
        }

        .view-btn {
            background: white;
            color: var(--primary);
            border: none;
            padding: 0.75rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .view-btn:hover {
            transform: scale(1.1);
        }

        .product-content {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .stock-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stock-text {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .in-stock {
            color: var(--success);
        }

        .low-stock {
            color: var(--warning);
        }

        .out-of-stock {
            color: var(--danger);
        }

        .price-section {
            text-align: right;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .price-unit {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        .add-cart-btn {
            flex: 1;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            font-weight: 600;
            transition: var(--transition);
        }

        .add-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .login-prompt-btn {
            flex: 1;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            text-decoration: none;
            transition: var(--transition);
            text-align: center;
        }

        .login-prompt-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .disabled-btn {
            flex: 1;
            background: var(--text-light);
            border: none;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: not-allowed;
        }

        /* État vide */
        .empty-catalogue {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-content i {
            font-size: 4rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .empty-content h3 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .empty-content p {
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            transition: var(--transition);
        }

        .refresh-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Dialog panier */
        .cart-dialog {
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
        }

        .cart-container {
            max-height: 70vh;
            display: flex;
            flex-direction: column;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .cart-header h3 {
            margin: 0;
            color: var(--dark);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--danger);
        }

        .cart-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .item-image {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .item-price {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: white;
            padding: 0.25rem;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            padding: 0;
            border: none;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .minus-btn {
            background: var(--warning);
            color: white;
        }

        .plus-btn {
            background: var(--success);
            color: white;
        }

        .qty-btn:hover {
            transform: scale(1.1);
        }

        .quantity {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .remove-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 6px;
            transition: var(--transition);
        }

        .remove-btn:hover {
            transform: scale(1.1);
        }

        .item-total {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .cart-summary {
            border-top: 2px solid var(--border);
            padding-top: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .summary-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .free-shipping {
            color: var(--success);
            font-weight: 600;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 1.2rem;
            font-weight: 700;
        }

        .total-amount {
            color: var(--primary);
            font-size: 1.4rem;
        }

        .cart-actions {
            display: flex;
            gap: 1rem;
        }

        .continue-btn {
            flex: 1;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .continue-btn:hover {
            background: var(--primary);
            color: white;
        }

        .checkout-btn {
            flex: 2;
            background: linear-gradient(135deg, var(--success), var(--primary));
            border: none;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            font-weight: 600;
            transition: var(--transition);
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 201, 240, 0.3);
        }

        .empty-cart {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-light);
        }

        .empty-cart i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--border);
        }

        .empty-cart h4 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .browse-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            margin-top: 1rem;
            transition: var(--transition);
        }

        .browse-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Pied de page */
        .catalogue-footer {
            background: var(--dark);
            color: white;
            margin-top: auto;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h4 {
            margin-bottom: 1rem;
            color: white;
        }

        .footer-section p {
            color: #bdc3c7;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .footer-bottom {
            border-top: 1px solid #34495e;
            padding: 1.5rem 2rem;
            text-align: center;
            color: #bdc3c7;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-main {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }

            .banner-content {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .catalogue-main {
                padding: 1rem;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .cart-item {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }

            .item-controls {
                justify-content: center;
            }

            .cart-actions {
                flex-direction: column;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .guest-actions, .user-actions {
                flex-direction: column;
                width: 100%;
            }

            .auth-btn, .orders-btn {
                width: 100%;
                text-align: center;
            }

            .product-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .price-section {
                text-align: left;
            }
        }
    </style>
</h:head>
<h:body>
    <div class="catalogue-app">
        <!-- Messages globaux -->
        <p:messages id="globalMsg" showDetail="true" autoUpdate="true" closable="true" 
                  styleClass="custom-messages"/>

        <div class="catalogue-container">
            <!-- En-tête avec navigation -->
            <header class="catalogue-header">
                <div class="header-main">
                    <div class="brand-section">
                        <div class="logo">
                            <i class="pi pi-shopping-bag"></i>
                        </div>
                        <div class="brand-info">
                            <h1 class="page-title">Boutique Elite</h1>
                            <p class="page-subtitle">Catalogue exclusif</p>
                        </div>
                    </div>

                    <!-- Navigation et actions -->
                    <div class="header-actions">
                        <!-- Message pour visiteur non connecté -->
                        <p:outputPanel rendered="#{not loginBean.userLoggedIn}">
                            <div class="guest-actions">
                                <p:button value="Se connecter" outcome="/login.xhtml" 
                                        styleClass="auth-btn login-btn" icon="pi pi-user"/>
                                <p:button value="Créer un compte" outcome="/inscription.xhtml" 
                                        styleClass="auth-btn register-btn" icon="pi pi-user-plus"/>
                            </div>
                        </p:outputPanel>

                        <!-- Panier pour utilisateur connecté -->
                        <p:outputPanel rendered="#{loginBean.userLoggedIn}">
                            <div class="user-actions">
                                <div class="user-welcome">
                                    <i class="pi pi-user"></i>
                                    <span>Bienvenue, #{loginBean.loggedInUser.login}</span>
                                </div>
                               <div class="cart-section">
								    <div class="cart-wrapper">
								        <p:commandButton id="cartBtn"
								                         type="button"
								                         icon="pi pi-shopping-cart"
								                         styleClass="cart-btn ui-button-rounded ui-button-help"
								                         onclick="PF('cartDialog').show(); return false;"
								                         update=":cartForm:cartPanel "/>
								        <!-- Badge dynamique -->
								        <p:outputPanel id="cartBadge"
								                       rendered="#{not empty catalogueBean.panier}"
								                       styleClass="cart-count">
								            #{catalogueBean.panier.size()}
								        </p:outputPanel>
								    </div>
								
								    <p:button value="Mes commandes" outcome="/mes-commandes.xhtml"
								              styleClass="orders-btn" icon="pi pi-list"/>
								</div>
								
								 <h:form id="topbarForm" rendered="#{loginBean.userLoggedIn}" styleClass="topbar-right">

            <p:commandButton icon="pi pi-sign-out"
                             value="Déconnexion"
                             action="#{loginBean.logout}"
                             styleClass="p-button-text p-button-danger p-button-sm"/>

        </h:form>

                            </div>
                        </p:outputPanel>
                    </div>
                </div>

                <!-- Bannière d'information -->
                <div class="header-banner">
                    <div class="banner-content">
                        <i class="pi pi-truck"></i>
                        <span>Livraison gratuite à partir de 50 000 FCFA</span>
                        <i class="pi pi-shield"></i>
                        <span>Paiement sécurisé</span>
                        <i class="pi pi-headphones"></i>
                        <span>Support 24/7</span>
                    </div>
                </div>
            </header>

            <!-- Formulaire principal pour le catalogue -->
            <h:form id="catalogueForm">
                <p:messages id="catalogueMsg" for="catalogueForm" showDetail="true" closable="true"/>

                <!-- Contenu principal -->
                <main class="catalogue-main">
                    <!-- Grille des produits -->
                    <section class="products-section">
                        <div class="products-header">
                            <h2 class="section-title">Nos Produits</h2>
                            <span class="products-count">#{catalogueBean.produits.size()} produits disponibles</span>
                        </div>

                        <div class="products-grid">
                            <ui:repeat value="#{catalogueBean.produits}" var="produit" varStatus="status">
                                <div class="product-card">
                                    <!-- Badge promotionnel -->
                                    <div class="product-badges">
                                        <p:outputPanel rendered="#{produit.stockDisponible lt 10 and produit.stockDisponible gt 0}">
                                            <span class="badge badge-warning">Stock limité</span>
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{produit.stockDisponible eq 0}">
                                            <span class="badge badge-danger">Rupture</span>
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{status.index lt 3}">
                                            <span class="badge badge-new">Nouveau</span>
                                        </p:outputPanel>
                                    </div>

                                    <!-- Image du produit -->
                                    <div class="product-image">
                                        <div class="image-container">
                                            <img src="#{adminProduitBean.getProductImageBase64(produit)}"
                                                 alt="#{produit.libelle}"
                                                 class="product-img"
                                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDI4MCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyODAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNDAgODBDMTE2LjU2NSA4MCA5OC4wMDAxIDk4LjU2NSA5OC4wMDAxIDEyMkM5OC4wMDAxIDE0NS40MzUgMTE2LjU2NSAxNjQgMTQwIDE2NEMxNjMuNDM1IDE2NCAxODIgMTQ1LjQzNSAxODIgMTIyQzE4MiA5OC41NjUgMTYzLjQzNSA4MCAxNDAgODBaTTE0MCAxNDBDMTI1LjY0IDE0MCAxMTQgMTI4LjM2IDExNCAxMTRDMTE0IDk5LjY0IDEyNS42NCA4OCAxNDAgODhDMTU0LjM2IDg4IDE2NiA5OS42NCAxNjYgMTE0QzE2NiAxMjguMzYgMTU0LjM2IDE0MCAxNDAgMTQwWk0xODQgNjRIMTc2VjU2SDE4NFY2NFpNMTg0IDU2SDE5MlY0OEgxODRWNTZaTTE4NCA0OEgxNzZWNDBIMTg0VjQ4Wk0xNzYgNDBIMTY4VjMySDE3NlY0MFpNMTY4IDMySDE3NlYyNEgxNjhWMzJaTTE3NiAyNEgxODRWMTZIMTc2VjI0Wk0xODQgMTZIMTkyVjhIMTg0VjE2Wk0xOTIgOEgxODRWMEgxOTJWOFpNMTg0IDBIMTc2VjhIMTg0VjBaTTE3NiA4SDE2OFYxNkgxNzZWOFpNMTY4IDE2SDE2MFYyNEgxNjhWMTZaTTE2MCAyNEgxNTJWMzJIMTYwVjI0Wk0xNTIgMzJIMTQ0VjQwSDE1MlYzMlpNMTQ0IDQwSDEzNlY0OEgxNDRWNDBaTTEzNiA0OEgxMjhWNTZIMTM2VjQ4Wk0xMjggNTZIMTIwVjY0SDEyOFY1NlpNMTIwIDY0SDEwOFY3MkgxMjBWNjRaTTEwOCA3MkgxMDBWODBIMTA4VjcyWk0xMDAgODBIMTMyVjcySDEwMFY4MFpNMTMyIDcySDE0NFY2NEgxMzJWNzJaTTE0NCA2NEgxNTJWNjRIMTQ0VjY0Wk0xNTIgNjRIMTYwVjcySDE1MlY2NFpNMTYwIDcySDE3NlY2NEgxNjBWNzJaTTE3NiA2NEgxODRWNjRIMTc2VjY0WiIgZmlsbD0iI0NEQ0RDRCIvPgo8L3N2Zz4K'"/>
                                        </div>
                                        <div class="image-overlay">
                                            <p:commandButton icon="pi pi-eye" styleClass="view-btn"
                                                           onclick="PF('productDetailDialog').show();"/>
                                        </div>
                                    </div>

                                    <!-- Informations du produit -->
                                    <div class="product-content">
                                        <h3 class="product-name">#{produit.libelle}</h3>
                                        <p class="product-description">
                                            Produit de qualité supérieure disponible en stock limité.
                                        </p>

                                        <div class="product-meta">
                                            <div class="stock-info">
                                                <i class="pi pi-box"></i>
                                                <span class="stock-text #{produit.stockDisponible gt 10 ? 'in-stock' : produit.stockDisponible gt 0 ? 'low-stock' : 'out-of-stock'}">
                                                    #{produit.stockDisponible gt 10 ? 'En stock' : 
                                                      produit.stockDisponible gt 0 ? 'Stock limité' : 'Rupture'}
                                                </span>
                                            </div>
                                            <div class="price-section">
                                                <span class="product-price">#{produit.prix} FCFA</span>
                                                <span class="price-unit">unité</span>
                                            </div>
                                        </div>

                                        <!-- Actions du produit -->
                                        <div class="product-actions">
                                            <p:outputPanel rendered="#{loginBean.userLoggedIn and produit.stockDisponible gt 0}">
                                                <p:commandButton value="Ajouter au panier"
                                                               action="#{catalogueBean.ajouter(produit.id)}"
                                                               styleClass="add-cart-btn"
                                                               process="@this"
                                                               update="catalogueForm:catalogueMsg :cartForm:cartPanel :cartBadge"
                                                               icon="pi pi-cart-plus">
                                                    <f:param name="productId" value="#{produit.id}"/>
                                                </p:commandButton>
                                            </p:outputPanel>

                                            <p:outputPanel rendered="#{not loginBean.userLoggedIn and produit.stockDisponible gt 0}">
                                                <p:button value="Se connecter" outcome="/login.xhtml"
                                                        styleClass="login-prompt-btn" icon="pi pi-lock"/>
                                            </p:outputPanel>

                                            <p:outputPanel rendered="#{produit.stockDisponible eq 0}">
                                                <p:commandButton value="Indisponible"
                                                               styleClass="disabled-btn"
                                                               disabled="true" icon="pi pi-ban"/>
                                            </p:outputPanel>
                                        </div>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>

                        <!-- État vide -->
                        <p:outputPanel rendered="#{empty catalogueBean.produits}">
                            <div class="empty-catalogue">
                                <div class="empty-content">
                                    <i class="pi pi-inbox"></i>
                                    <h3>Aucun produit disponible</h3>
                                    <p>Notre catalogue est en cours de réapprovisionnement.</p>
                                    <p:button value="Actualiser" outcome="" styleClass="refresh-btn" icon="pi pi-refresh"/>
                                </div>
                            </div>
                        </p:outputPanel>
                    </section>
                </main>
            </h:form>
        </div>

        <!-- Formulaire séparé pour le panier -->
        <p:outputPanel rendered="#{loginBean.userLoggedIn}">
            <h:form id="cartForm">
                <p:messages id="cartMsg" for="cartForm" showDetail="true" closable="true"/>
                
                <p:dialog widgetVar="cartDialog" header="Mon Panier" modal="true"
                          resizable="false" draggable="false" styleClass="cart-dialog">
                    <p:outputPanel id="cartPanel">
                        <div class="cart-container">
                            <!-- En-tête du panier -->
                            <div class="cart-header">
                                <h3>Votre sélection</h3>
                                <p:commandButton icon="pi pi-times" onclick="PF('cartDialog').hide();"
                                               styleClass="close-btn" type="button"/>
                            </div>

                            <!-- Contenu du panier -->
                            <div class="cart-content">
                                <p:outputPanel rendered="#{not empty catalogueBean.cartLines}">
                                    <div class="cart-items">
                                        <ui:repeat value="#{catalogueBean.cartLines}" var="item">
                                            <div class="cart-item">
                                                <div class="item-image">
                                                    <i class="pi pi-box"></i>
                                                </div>
                                                <div class="item-details">
                                                    <h4 class="item-name">#{item.libelle}</h4>
                                                    <p class="item-price">#{item.prixUnitaire} FCFA</p>
                                                    <div class="item-controls">
                                                        <div class="quantity-controls">
                                                            <p:commandButton icon="pi pi-minus"
                                                                           action="#{catalogueBean.dec(item.produitId)}"
                                                                           process="@this"
                                                                           update=":cartForm:cartPanel catalogueForm:catalogueMsg"
                                                                           styleClass="qty-btn minus-btn"/>
                                                            <span class="quantity">#{item.quantite}</span>
                                                            <p:commandButton icon="pi pi-plus"
                                                                           action="#{catalogueBean.inc(item.produitId)}"
                                                                           process="@this"
                                                                           update=":cartForm:cartPanel catalogueForm:catalogueMsg"
                                                                           styleClass="qty-btn plus-btn"/>
                                                        </div>
                                                        <p:commandButton icon="pi pi-trash"
                                                                       action="#{catalogueBean.remove(item.produitId)}"
                                                                       process="@this"
                                                                       update=":cartForm:cartPanel catalogueForm:catalogueMsg"
                                                                       styleClass="remove-btn"
                                                                       title="Supprimer"/>
                                                    </div>
                                                </div>
                                                <div class="item-total">
                                                    <span>#{item.ligneTotal} FCFA</span>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>

                                    <!-- Récapitulatif du panier -->
                                    <div class="cart-summary">
                                        <div class="summary-line">
                                            <span>Sous-total</span>
                                            <span>#{catalogueBean.total} FCFA</span>
                                        </div>
                                        <div class="summary-line">
                                            <span>Livraison</span>
                                            <span class="free-shipping">Gratuite</span>
                                        </div>
                                        <div class="summary-total">
                                            <span>Total</span>
                                            <span class="total-amount">#{catalogueBean.total} FCFA</span>
                                        </div>
                                    </div>

                                    <!-- Actions du panier -->
                                    <div class="cart-actions">
                                        <p:commandButton value="Continuer mes achats"
                                                       onclick="PF('cartDialog').hide();"
                                                       styleClass="continue-btn" icon="pi pi-arrow-left"/>
                                        <p:commandButton value="Commander"
                                                       action="#{catalogueBean.commander}"
                                                       styleClass="checkout-btn"
                                                       process="@this"
                                                       update="catalogueForm:catalogueMsg"
                                                       onclick="if(!args.validationFailed) PF('cartDialog').hide();"
                                                       icon="pi pi-check"/>
                                    </div>
                                </p:outputPanel>

                                <!-- Panier vide -->
                                <p:outputPanel rendered="#{empty catalogueBean.cartLines}">
                                    <div class="empty-cart">
                                        <i class="pi pi-shopping-cart"></i>
                                        <h4>Votre panier est vide</h4>
                                        <p>Ajoutez des produits pour commencer vos achats</p>
                                        <p:commandButton value="Parcourir le catalogue"
                                                       onclick="PF('cartDialog').hide();"
                                                       styleClass="browse-btn" icon="pi pi-search"/>
                                    </div>
                                </p:outputPanel>
                            </div>
                        </div>
                    </p:outputPanel>
                </p:dialog>
            </h:form>
        </p:outputPanel>

        <!-- Pied de page -->
        <footer class="catalogue-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Boutique Elite</h4>
                    <p>Votre partenaire de confiance pour des produits de qualité.</p>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p><i class="pi pi-phone"></i> +225 07 07 07 07 07</p>
                    <p><i class="pi pi-envelope"></i> contact@boutiqueelite.ci</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p> 2024 Boutique Elite. Tous droits réservés.</p>
            </div>
        </footer>
    </div>


</h:body>
</html>