<ui:composition template="/WEB-INF/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:define name="title">Admin ‚Äî Gestion des Familles</ui:define>

    <ui:define name="content">
        <f:event type="preRenderView" listener="#{loginBean.checkAccess('ADMIN')}"/>

        <!-- Background avec gradient raffin√© -->
        <div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 relative overflow-hidden">
            <!-- Effets de fond subtils -->
            <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-blue-200/20 via-transparent to-transparent"></div>
            <div class="absolute top-10 left-10 w-64 h-64 bg-emerald-200/30 rounded-full blur-3xl"></div>
            <div class="absolute bottom-10 right-10 w-80 h-80 bg-violet-200/30 rounded-full blur-3xl"></div>
            
            <div class="relative z-10">
                <!-- Header √âl√©gant -->
                <div class="bg-white/80 backdrop-blur-md border border-gray-200/60 rounded-3xl mx-6 mt-6 shadow-lg">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between p-8">
                        <div class="flex items-center mb-6 lg:mb-0">
                            <div class="relative">
                                <div class="absolute inset-0 bg-gradient-to-r from-emerald-400 to-cyan-500 rounded-2xl blur opacity-60"></div>
                                <div class="relative bg-gradient-to-r from-emerald-500 to-cyan-600 p-4 rounded-2xl shadow-lg">
                                    <i class="pi pi-tags text-2xl text-white"></i>
                                </div>
                            </div>
                            <div class="ml-6">
                                <h1 class="text-4xl font-bold text-gray-800">
                                    Gestion des Familles
                                </h1>
                                <p class="text-gray-600 mt-2 text-lg font-medium">Organisez vos produits par cat√©gories th√©matiques</p>
                            </div>
                        </div>
                        
                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-emerald-400 to-cyan-500 rounded-2xl blur opacity-60 group-hover:opacity-80 transition duration-300"></div>
                            <div class="relative bg-white/90 border border-emerald-200 rounded-xl px-6 py-4 backdrop-blur-sm shadow-lg">
                                <div class="flex items-center">
                                    <div class="bg-emerald-100 p-2 rounded-lg mr-3">
                                        <i class="pi pi-tag text-emerald-600 text-xl"></i>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-gray-800">#{adminFamilleBean.familles.size()}</div>
                                        <div class="text-emerald-600 font-medium text-sm">Familles actives</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenu Principal -->
                <div class="p-6">
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                        <!-- Sidebar - Actions Rapides -->
                        <div class="xl:col-span-1 space-y-6">
                            <!-- Carte Actions -->
                            <div class="bg-white/80 backdrop-blur-sm border border-gray-200/60 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300">
                                <div class="p-6">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                        <i class="pi pi-bolt text-emerald-500 mr-3"></i>
                                        Actions Rapides
                                    </h3>
                                    
                                    <h:form id="toolbarForm">
                                        <p:messages id="msgs" showDetail="true" closable="true" 
                                                  styleClass="custom-growl"/>
                                        
                                        <div class="space-y-4">
                                            <p:commandButton value="‚ûï Nouvelle famille" 
                                                           action="#{adminFamilleBean.nouveau}"
                                                           process="@this"
                                                           update="mainContent tableForm"
                                                           styleClass="w-full bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white py-4 rounded-xl font-bold text-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 border-0"/>
                                            
                                            <div class="relative">
                                                <i class="pi pi-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 z-10"></i>
                                                <p:inputText placeholder="üîç Rechercher..." 
                                                           styleClass="w-full pl-12 pr-4 py-4 bg-white border border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300"/>
                                            </div>
                                        </div>
                                    </h:form>
                                </div>
                            </div>

                            <!-- Statistiques -->
                            <div class="bg-white/80 backdrop-blur-sm border border-gray-200/60 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                    <i class="pi pi-chart-line text-violet-500 mr-3"></i>
                                    Vue d'ensemble
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                                        <span class="text-gray-700 font-medium">Total familles</span>
                                        <span class="text-2xl font-bold text-emerald-600">#{adminFamilleBean.familles.size()}</span>
                                    </div>
                                    <div class="flex justify-between items-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                        <span class="text-gray-700 font-medium">Familles actives</span>
                                        <span class="text-2xl font-bold text-blue-600">#{adminFamilleBean.familles.size()}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contenu Principal -->
                        <div class="xl:col-span-2 space-y-6">
                            <!-- Formulaire de Cr√©ation/√âdition -->
                            <h:form id="mainContent">
                            <ui:fragment rendered="#{adminFamilleBean.showNew or adminFamilleBean.editMode}">
                            <div class="bg-white/80 backdrop-blur-sm border border-gray-200/60 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300">
                                    <div class="bg-gradient-to-r from-emerald-50 to-cyan-50 px-6 py-4 border-b border-gray-200/60">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="bg-gradient-to-r from-emerald-500 to-cyan-600 p-3 rounded-xl shadow-md">
                                                    <i class="pi #{adminFamilleBean.editMode ? 'pi-pencil' : 'pi-plus-circle'} text-white text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 class="text-2xl font-bold text-gray-800">
                                                        #{adminFamilleBean.editMode ? 'Modifier la famille' : 'Nouvelle famille'}
                                                    </h3>
                                                    <p class="text-gray-600 text-sm mt-1 font-medium">
                                                        #{adminFamilleBean.editMode ? 
                                                          'Modifiez les informations de la famille' : 
                                                          'Cr√©ez une nouvelle cat√©gorie pour organiser vos produits'}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-6">
                                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                            <!-- Nom -->
                                            <div class="space-y-3">
                                                <label class="block text-sm font-semibold text-gray-700">
                                                    üìù Nom de la famille
                                                    <span class="text-red-500 ml-1">*</span>
                                                </label>
                                                <p:inputText value="#{adminFamilleBean.current.nom}"
                                                           required="true" requiredMessage="Le nom de la famille est requis"
                                                           placeholder="Saisissez le nom de la famille"
                                                           styleClass="w-full px-4 py-4 bg-white border-2 border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300"/>
                                                <p class="text-xs text-gray-600 font-medium">Ex: √âlectronique, V√™tements, Alimentation...</p>
                                            </div>

                                            <!-- Description -->
                                            <div class="lg:col-span-2 space-y-3">
                                                <label class="block text-sm font-semibold text-gray-700">üìã Description</label>
                                                <p:inputTextarea value="#{adminFamilleBean.current.description}"
                                                               rows="3" 
                                                               placeholder="D√©crivez le type de produits de cette famille (optionnel)"
                                                               styleClass="w-full px-4 py-4 bg-white border-2 border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300 resize-vertical"/>
                                                <p class="text-xs text-gray-600 font-medium">Cette description aide √† identifier le contenu de cette famille</p>
                                            </div>
                                            
                                            <!-- S√©lection des catalogues -->
                                            <div class="lg:col-span-2 space-y-3">
                                                <div class="flex items-center justify-between">
                                                    <label class="block text-sm font-semibold text-gray-700">
                                                        üóÇÔ∏è Catalogues associ√©s
                                                    </label>
                                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-semibold">
                                                        #{empty adminFamilleBean.catalogueIds ? 'Aucun' : adminFamilleBean.catalogueIds.size()} catalogue(s) s√©lectionn√©(s)
                                                    </span>
                                                </div>
                                                
                                                <p:selectCheckboxMenu id="catalogueSelect" 
                                                                    value="#{adminFamilleBean.catalogueIds}"
                                                                    label="S√©lectionner des catalogues"
                                                                    filter="true" 
                                                                    filterMatchMode="contains"
                                                                    multiple="true"
                                                                    panelStyle="width:100%;max-height:300px;"
                                                                    styleClass="w-full">
                                                    <f:selectItems value="#{adminFamilleBean.allCatalogues}" 
                                                                 var="catalogue"
                                                                 itemLabel="#{catalogue.nom}" 
                                                                 itemValue="#{catalogue.id}" />
                                                </p:selectCheckboxMenu>
                                                
                                                <ui:fragment rendered="#{not empty adminFamilleBean.selectedCatalogues}">
                                                    <div class="flex flex-wrap gap-2 mt-2">
                                                        <ui:repeat value="#{adminFamilleBean.selectedCatalogues}" var="catalogue">
                                                            <span class="bg-gradient-to-r from-blue-100 to-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs font-medium">
                                                                #{catalogue.nom}
                                                            </span>
                                                        </ui:repeat>
                                                    </div>
                                                </ui:fragment>
                                            </div>
                                        </div>

                                        <!-- Actions -->
                                        <div class="flex flex-col sm:flex-row gap-4 justify-end pt-6 border-t border-gray-200">
                                            <p:commandButton value="‚ùå Annuler"
                                                           action="#{adminFamilleBean.annuler}"
                                                           process="@this"
                                                           update="mainContent tableForm"
                                                           immediate="true"
                                                           styleClass="px-8 py-4 bg-gray-100 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-200 hover:border-gray-400 transition-all duration-300 transform hover:scale-105"/>
                                            <p:commandButton value="#{adminFamilleBean.editMode ? 'üíæ Mettre √† jour' : 'üöÄ Cr√©er la famille'}"
                                                           icon="pi pi-check"
                                                           action="#{adminFamilleBean.save}"
                                                           process="@form"
                                                           update="toolbarForm:msgs tableForm:familiesTable mainContent"
                                                           styleClass="px-8 py-4 bg-gradient-to-r from-emerald-500 to-cyan-600 hover:from-emerald-600 hover:to-cyan-700 text-white rounded-xl font-bold shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 border-0"/>
                                        </div>
                                    </div>
                                </div>
                            </ui:fragment>
                            </h:form>

                            <!-- Tableau des Familles -->
                            <div class="bg-white/80 backdrop-blur-sm border border-gray-200/60 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200/60">
                                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                        <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                                            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-3 rounded-lg shadow-md">
                                                <i class="pi pi-list text-white text-lg"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-2xl font-bold text-gray-800">Liste des Familles</h3>
                                                <p class="text-gray-600 text-sm mt-1 font-medium">
                                                    Toutes vos cat√©gories de produits organis√©es
                                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold ml-2 border border-blue-200">
                                                        #{adminFamilleBean.getFamilles().size()}
                                                    </span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <h:form id="tableForm">
                                    <div class="overflow-x-auto">
                                        <p:dataTable id="familiesTable" value="#{adminFamilleBean.familles}" var="f"
                                                   widgetVar="familiesTable" paginator="true" rows="8"
                                                   emptyMessage="Aucune famille trouv√©e"
                                                   styleClass="min-w-full modern-table"
                                                   globalFilter="globalFilter"
                                                   filteredValue="#{adminFamilleBean.getFamilles()}"
                                                   paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                   rowsPerPageTemplate="5,8,12,16"
                                                   style="border: none;">

                                            <!-- ID -->
                                            <p:column headerText="ID" sortBy="#{f.id}" style="width: 100px;"
                                                    styleClass="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-700 border border-gray-300">
                                                    #{f.id}
                                                </span>
                                            </p:column>

                                            <!-- Nom -->
                                            <p:column headerText="Famille" sortBy="#{f.nom}" filterBy="#{f.nom}"
                                                    filterMatchMode="contains" 
                                                    styleClass="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                                <div class="flex items-center space-x-4 family-item">
                                                    <div class="w-12 h-12 bg-gradient-to-r from-emerald-400 to-cyan-500 rounded-xl flex items-center justify-center hover-scale-110 transition duration-300 shadow-md">
                                                        <i class="pi pi-tag text-white text-lg"></i>
                                                    </div>
                                                    <div class="min-w-0 flex-1">
                                                        <p class="text-lg font-bold text-gray-800 hover:text-emerald-600 transition duration-300">#{f.nom}</p>
                                                        <ui:fragment rendered="#{not empty f.description}">
                                                            <p class="text-sm text-gray-600 hover:text-gray-700 transition duration-300 truncate">#{f.description}</p>
                                                        </ui:fragment>
                                                    </div>
                                                </div>
                                            </p:column>

                                            <!-- Statut -->
                                            <p:column headerText="Statut" style="width: 120px;"
                                                    styleClass="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                                <span class="inline-flex items-center px-3 py-2 rounded-full text-sm font-bold bg-emerald-100 text-emerald-700 border border-emerald-300">
                                                    <div class="w-2 h-2 bg-emerald-500 rounded-full mr-2"></div>
                                                    Active
                                                </span>
                                            </p:column>

                                            <!-- Actions -->
                                            <p:column headerText="Actions" style="width: 160px;"
                                                    styleClass="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                                <div class="flex items-center space-x-2">
                                                    <p:commandButton icon="pi pi-pencil" 
                                                                   title="Modifier"
                                                                   action="#{adminFamilleBean.edit(f.id)}"
                                                                   process="@this"
                                                                   update="mainContent toolbarForm:msgs"
                                                                   oncomplete="if(!args.validationFailed){ scrollToCreateForm(); }"
                                                                   styleClass="w-10 h-10 bg-blue-500 hover:bg-blue-600 text-white border border-blue-500 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:shadow-md"/>
                                                    <p:commandButton icon="pi pi-trash" 
                                                                   title="Supprimer"
                                                                   action="#{adminFamilleBean.delete(f.id)}"
                                                                   process="@this"
                                                                   update="toolbarForm:msgs familiesTable"
                                                                   onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer la famille \\'#{f.nom}\\' ? Cette action ne peut pas √™tre annul√©e.')"
                                                                   styleClass="w-10 h-10 bg-red-500 hover:bg-red-600 text-white border border-red-500 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:shadow-md"/>
                                                    <p:commandButton icon="pi pi-eye" 
                                                                   title="Voir d√©tails"
                                                                   styleClass="w-10 h-10 bg-gray-500 hover:bg-gray-600 text-white border border-gray-500 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:shadow-md"/>
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                    </div>

                                    <!-- Footer du Tableau -->
                                    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                                            <div class="flex items-center space-x-6">
                                                <div class="flex items-center space-x-3">
                                                    <div class="w-3 h-3 bg-emerald-500 rounded-full"></div>
                                                    <span class="text-sm text-gray-700 font-medium">Statut actif</span>
                                                </div>
                                                <div class="flex items-center space-x-3">
                                                    <div class="w-8 h-1 bg-gradient-to-r from-emerald-400 to-cyan-500 rounded-full"></div>
                                                    <span class="text-sm text-gray-700 font-medium">Cat√©gorie produit</span>
                                                </div>
                                            </div>
                                            <div class="text-sm text-gray-700 font-medium">
                                                Total: <span class="font-bold text-gray-800 text-lg">#{adminFamilleBean.familles.size()}</span> familles
                                            </div>
                                        </div>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            /* Styles personnalises raffin√©s */
            .custom-growl {
                position: fixed !important;
                top: 20px !important;
                right: 20px !important;
                width: auto !important;
                min-width: 400px;
                z-index: 10000;
                background: white !important;
                border: 1px solid #e5e7eb !important;
                border-radius: 12px !important;
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1) !important;
                color: #374151 !important;
            }

            /* Table moderne */
            .modern-table {
                background: transparent !important;
            }

            .modern-table .ui-datatable-header {
                background: transparent !important;
                border: none !important;
                color: #374151 !important;
            }

            .modern-table .ui-datatable-thead > tr > th {
                background: #f9fafb !important;
                border: none !important;
                border-bottom: 2px solid #e5e7eb !important;
                color: #374151 !important;
                font-weight: 600 !important;
            }

            .modern-table .ui-datatable-data > tr {
                background: white !important;
                border: none !important;
                transition: all 0.3s ease !important;
            }

            .modern-table .ui-datatable-data > tr:nth-child(even) {
                background: #fafafa !important;
            }

            .modern-table .ui-datatable-data > tr:hover {
                background: #f0fdf4 !important;
                transform: translateX(4px);
                border-left: 3px solid #10b981 !important;
            }

            .modern-table .ui-datatable-data > tr > td {
                border: none !important;
                border-bottom: 1px solid #f3f4f6 !important;
                color: #374151 !important;
                background: transparent !important;
            }

            /* Pagination personnalis√©e */
            .ui-paginator {
                background: #f9fafb !important;
                border: none !important;
                border-top: 1px solid #e5e7eb !important;
                padding: 1rem 1.5rem !important;
            }

            .ui-paginator .ui-paginator-page,
            .ui-paginator .ui-paginator-first,
            .ui-paginator .ui-paginator-prev,
            .ui-paginator .ui-paginator-next,
            .ui-paginator .ui-paginator-last {
                background: white !important;
                border: 1px solid #d1d5db !important;
                color: #374151 !important;
                border-radius: 8px !important;
                margin: 0 3px !important;
                transition: all 0.3s ease;
            }

            .ui-paginator .ui-state-active {
                background: linear-gradient(135deg, #10b981, #06b6d4) !important;
                color: white !important;
                border-color: #10b981 !important;
                transform: scale(1.05);
            }

            .ui-paginator .ui-paginator-page:hover,
            .ui-paginator .ui-paginator-first:hover,
            .ui-paginator .ui-paginator-prev:hover,
            .ui-paginator .ui-paginator-next:hover,
            .ui-paginator .ui-paginator-last:hover {
                background: #f0fdf4 !important;
                border-color: #10b981 !important;
                transform: translateY(-1px);
            }

            /* Animation d'entr√©e */
            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .bg-white\\/80 {
                animation: slideInUp 0.5s ease-out;
            }

            /* Scrollbar personnalis√©e */
            ::-webkit-scrollbar {
                width: 6px;
            }

            ::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, #10b981, #06b6d4);
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(135deg, #059669, #0891b2);
            }

            /* Effets de focus am√©lior√©s */
            .modern-input:focus,
            .modern-textarea:focus {
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
            }
        </style>

        <script>
            function scrollToCreateForm() {
                const el = document.querySelector('.bg-white\\/80');
                if (el) {
                    window.scrollTo({
                        top: el.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            }

            // Animation des cartes au chargement
            document.addEventListener('DOMContentLoaded', function() {
                const cards = document.querySelectorAll('.bg-white\\/80');
                cards.forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        card.style.transition = 'all 0.6s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 150);
                });
            });
        </script>
    </ui:define>
</ui:composition>